# 데이터베이스 설치 결과

## 설치 정보

- **설치일시**: 2025-07-24
- **AKS 클러스터**: aks-digitalgarage-01
- **네임스페이스**: tripgen
- **데이터베이스 시스템**: PostgreSQL 16.2.0
- **Helm Chart**: bitnami/postgresql 14.3.2

## 설치 상태

### 1. Pod 상태
```bash
NAME                    READY   STATUS    RESTARTS   AGE
postgres-postgresql-0   1/1     Running   0          4m
```

### 2. 서비스 정보
- **내부 서비스**: postgres-postgresql.tripgen.svc.cluster.local (포트: 5432)
- **외부 LoadBalancer**: 20.249.130.104 (포트: 5432)

## 생성된 데이터베이스

다음 데이터베이스가 성공적으로 생성되었습니다:

1. **tripgen** - 요구사항에 명시된 메인 데이터베이스
2. **telecomdb** - 기본 애플리케이션 데이터베이스
3. **member_db** - 회원 관리 데이터베이스
4. **subscription_db** - 구독 관리 데이터베이스
5. **recommend_db** - 구독 추천 데이터베이스

## 접속 정보

### 관리자 계정
- **Username**: postgres
- **Password**: Hi5Jessica!
- **권한**: 모든 데이터베이스에 대한 전체 권한

### 애플리케이션 계정
- **Username**: telecomuser
- **Password**: Hi5Jessica!
- **권한**: 모든 데이터베이스에 대한 전체 권한
- **기본 데이터베이스**: telecomdb

## DBeaver 접속 방법

### 1. DBeaver 설치
- https://dbeaver.io/download/ 에서 다운로드 및 설치

### 2. 새 연결 생성

#### 2.1 연결 추가
1. DBeaver를 실행하고 "새 데이터베이스 연결" 클릭 (또는 상단 메뉴의 Database → New Database Connection)
2. PostgreSQL 선택 후 "다음" 클릭

#### 2.2 연결 설정
다음 정보로 연결을 설정합니다:

- **Server Host**: 20.249.130.104
- **Port**: 5432
- **Database**: tripgen (또는 telecomdb, member_db, subscription_db, recommend_db 중 선택)
- **Username**: telecomuser (또는 postgres)
- **Password**: Hi5Jessica!

#### 2.3 추가 설정 (선택사항)
- Main 탭에서 "Show all databases" 체크하면 모든 데이터베이스를 한 번에 확인 가능
- SSL 탭: SSL 설정은 필요하지 않음 (비활성화 상태 유지)

### 3. 연결 테스트
1. "Test Connection" 버튼 클릭
2. "Connected" 메시지 확인
3. "확인" 클릭하여 연결 저장

### 4. 데이터베이스 접근
연결 후 다음 데이터베이스들에 접근 가능:
- tripgen (메인 데이터베이스)
- telecomdb (애플리케이션 기본 DB)
- member_db (회원 관리)
- subscription_db (구독 관리)
- recommend_db (구독 추천)

## 관리 명령어

### Pod 상태 확인
```bash
kubectl get pods -n tripgen
kubectl logs postgres-postgresql-0 -n tripgen
```

### 서비스 상태 확인
```bash
kubectl get svc -n tripgen
kubectl get svc postgres-external -n tripgen
```

### 데이터베이스 목록 확인
```bash
kubectl exec -n tripgen postgres-postgresql-0 -- /bin/bash -c "/opt/bitnami/scripts/postgresql/entrypoint.sh /bin/bash -c 'PGPASSWORD=Hi5Jessica! psql -U postgres -c \"\l\"'"
```

### 비밀번호 확인
```bash
# postgres 계정 비밀번호
kubectl get secret --namespace tripgen postgres-postgresql -o jsonpath="{.data.postgres-password}" | base64 -d

# telecomuser 계정 비밀번호
kubectl get secret --namespace tripgen postgres-postgresql -o jsonpath="{.data.password}" | base64 -d
```

## 문제 해결

### 연결이 안 될 경우
1. LoadBalancer IP 확인:
   ```bash
   kubectl get svc postgres-external -n tripgen
   ```

2. Pod 상태 확인:
   ```bash
   kubectl get pods -n tripgen
   kubectl describe pod postgres-postgresql-0 -n tripgen
   ```

3. 방화벽 설정 확인:
   - 5432 포트가 열려있는지 확인
   - 회사 네트워크에서 접근하는 경우 VPN 연결 필요할 수 있음

### 비밀번호 인증 실패
- 위의 비밀번호 확인 명령어로 실제 비밀번호 재확인
- DBeaver에서 비밀번호 입력 시 복사/붙여넣기 사용 권장

## 주의사항

1. **보안**: 외부 LoadBalancer로 노출되어 있으므로 강력한 비밀번호 사용 중요
2. **백업**: 프로덕션 환경에서는 정기적인 백업 설정 필요
3. **리소스**: 현재 개발/테스트용 설정이므로 프로덕션 환경에서는 리소스 증설 고려

## 설치 파일 위치
- 설치 스크립트: `build/backing-service/database/install-postgresql-aks.sh`
- 설치 가이드: `build/backing-service/database/postgresql-installation-guide.md`
- Helm values: `~/install/postgres/values.yaml`
- LoadBalancer 설정: `~/install/postgres/postgres-external.yaml`